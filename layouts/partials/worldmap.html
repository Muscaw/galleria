{{ $pins := .pins }}


<div id="worldmap"></div>
<script>
  var map = L.map("worldmap", { zoomControl: false });

  L.tileLayer(
    "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
    {
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: "abcd",
    },
  ).addTo(map);

  var latLons = [
  {{ range $i, $val := $pins }}
    [{{$val.latlon | safeJS}}],
  {{ end }}
  ];

  var polyline = L.polyline(latLons, {color: "#791e94"}).addTo(map);
  map.fitBounds(polyline.getBounds());

  {{ $markerSize := 25 }}

  {{ range $i, $val := $pins }}
  L.marker([{{$val.latlon | safeJS}}], {icon: L.divIcon({iconSize: [{{$markerSize}}, {{$markerSize}}], className: "mapMarker", html: "{{(substr ($val.locationEmoji | safeJS) 0 2)}}"})}).addTo(map);
  {{ end }}

</script>
